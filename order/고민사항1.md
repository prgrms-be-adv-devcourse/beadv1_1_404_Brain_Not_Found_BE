# 고민사항 정리

## 주문·결제 흐름 설계 관련
### 주문과 결제 흐름 전반 점검
- 질문: 주문과 결제 로직 전체를 다시 검토했을 때 어떤 보완점이 필요한가?
- 답변 요약:
  - 주문 생성 시 결제를 즉시 호출하고 결제 성공 여부에 따라 주문 상태를 업데이트하므로 기본 흐름은 문제없음.
  - 결제 모듈에서는 토스 응답 검증, 예치금 로직 TODO 등 보강 필요.
  - 응답 DTO를 구조화하고 예외를 세분화하면 주문 서비스가 결제 결과를 더 잘 처리할 수 있음.

### 결제 요청/완료 API 별도 분리 여부
- 질문: 주문 생성에서 결제까지 처리하는데 별도의 결제 요청/완료 API가 필요한가?
- 답변 요약:
  - 현재 주문 생성 API에서 바로 결제까지 처리하므로 `POST /api/orders/payment`, `POST /api/orders/{orderCode}/payment/complete` 등은 없어도 됨.
  - 다만 토스 웹훅, 재결제 등 외부 요인이 생기면 향후 별도 API를 고려할 수 있음.

### 주문 검증 API 필요성
- 질문: 주문 검증 API를 따로 둘 필요가 있는가?
- 답변 요약:
  - 기본적인 요청 검증과 상품/사용자 존재 여부 확인은 현재 로직에서 이미 수행되고 있어 필수는 아님.
  - 장바구니 상태를 사전에 검증하고 싶다면 별도 API를 두고, 주문 확정 시점에는 DB 락을 통해 일관성을 보장하는 방식이 이상적.

### 주문 완료 처리 API 필요성
- 질문: 주문 완료 처리 API도 제거 가능한가?
- 답변 요약:
  - 주문 생성 과정에서 결제 성공 시 주문을 완료로 보기 때문에 별도 완료 API는 불필요.
  - 배송/수령 후 확정 등 추가 상태가 필요하면 그때 별도 완료 API를 추가.

### 주문 목록 조회와 검색
- 질문: 주문 목록 조회에서 검색을 지원하면 검색 API가 별도로 필요 없는가?
- 답변 요약:
  - `GET /api/orders`에서 `keyword`를 통해 검색까지 수행하므로 별도 검색 API는 불필요.
  - 향후 검색 조건이 복잡해지면 분리 가능.

## 주문 상태/취소 관련
### 주문 상태 변경 API 활용
- 질문: 주문 상태 변경 API는 어떤 상황에서 쓰는지?
- 답변 요약:
  - 배송 진행, 구매 확정, 환불, 재결제 등 다양한 상태 전환에 사용.
  - 권한 및 보상 로직이 다르면 취소 API를 별도로 둘 필요가 있음.

### 주문 취소 API와 상태 변경 API 분리
- 질문: 주문 취소와 상태 변경 API를 분리해야 하는지?
- 답변 요약:
  - 단순 상태 변경이라면 하나의 API로 처리 가능.
  - 취소 시 예치금 복구나 결제 취소 등 추가 로직이 필요하면 전용 취소 API 권장.

## DTO/Validation 관련
### Bean Validation 적용 후 서비스 검증 여부
- 질문: `@Valid`를 사용하면 서비스 내 검증 로직은 제거해도 되나?
- 답변 요약:
  - Bean Validation으로 요청 필수값이 이미 검증되므로 서비스에서 중복 체크는 불필요.
  - 도메인 규칙 검증(재고, 정책 등)은 서비스 레이어에서 별도로 유지해야 함.

## 프론트 UX 및 락 전략
- 질문: 장바구니에서 주문으로 넘어가기 전에 검증 API가 필요한가?
- 답변 요약:
  - UX를 위해 사전 검증 API로 최신 상태를 확인하고, 주문 확정 시점에는 재검증과 DB 락으로 정합성을 보장하는 전략이 권장됨.

## git 관련 Q&A 메모
### rebase 중 충돌 처리
- `git rebase --abort`로 충돌 발생 시 리베이스를 취소하고 기존 상태로 복구.

### 원격 브랜치 push 거절
- 로컬보다 원격 `feat/payment-12` 브랜치가 더 앞서 있는 경우 `git pull origin feat/payment-12 --rebase` 후 push.


